import{A as I}from"./AuthenticatedLayout-e0b7f8ec.js";import{u as l,b as P,R as S,j as s,a,H as B}from"./app-3b14edf2.js";import{I as n}from"./InputLabel-8665140f.js";import{T as c,I as m}from"./TextInput-edb2b3ad.js";import{S as p}from"./Toast-1f814f61.js";import"./Table-29b362e9.js";import{P as T}from"./PrimaryButton-28166509.js";import{R as D}from"./Alert-10dd726c.js";import{a as F}from"./axios-468742d6.js";import{B as A}from"./BackButton-d8b9f37c.js";import"./ApplicationLogo-30229999.js";import"./transition-da3d9d06.js";import"./index.esm-b46f3593.js";function Q({auth:h}){const g=l().props.servers,v=l().props.connections,f=l().props.keys,{data:t,setData:r,post:b,processing:x,reset:R,errors:d}=P({server_id:"",connection_id:"",username:"root",port:"22",key_id:"",password:""}),N=l().props.auth.user,y=l().props.alert,[o,u]=S.useState(!1),_=e=>{e.preventDefault(),b(route("sftp.store")),navigate(route("sftp.index"))},k=e=>{r(i=>({...i,connection_id:e.target.value})),e.target.value!==""?u(!0):u(!1);const w={headers:{Authorization:`Bearer ${N.api_token}`}};e.target.value!==""&&F.get(route("api.connection.show",e.target.value),w).then(i=>{r(C=>({...C,server_id:i.data.server_id}))}).catch(i=>{console.log("Error fetching connection details")})};return s(I,{auth:h,header:a("h2",{className:"font-semibold text-xl text-gray-800 dark:text-white leading-tight",children:"Create SFTP connection"}),children:[a(B,{title:"Create SFTP connection"}),s("div",{className:"py-8 px-2 mx-auto max-w-7xl lg:py-10",children:[a("div",{className:"flex flex-wrap gap-2 mb-4",children:a(A,{href:route("sftp.index"),children:"Back to SFTP connections"})}),a(D,{details:y}),a("section",{className:"bg-white dark:bg-gray-700 overflow-hidden shadow-sm sm:rounded-lg p-2 sm:p-6",children:s("form",{onSubmit:_,children:[s("div",{className:"grid gap-2 sm:grid-cols-1 md:grid-cols-4 sm:gap-4",children:[s("div",{className:"sm:col-span-2 col-span-4",children:[a("div",{className:"mb-2 block",children:a(n,{forInput:"server_id",value:"Server"})}),s(p,{onChange:e=>r("server_id",e.target.value),name:"server_id",required:!0,value:t.server_id,handleChange:e=>r("server_id",e.target.value),disabled:o,children:[a("option",{value:"",children:"Choose one"}),g.map(e=>s("option",{value:e.id,children:[e.title," (",e.hostname,")"]}))]})]}),s("div",{className:"sm:col-span-2 col-span-4",children:[a("div",{className:"mb-2 block",children:a(n,{forInput:"connection_id",value:"Use this connection"})}),s(p,{onChange:k,name:"connection_id",value:t.connection_id,handleChange:e=>r("connection_id",e.target.value),children:[a("option",{value:"",children:"None (fill in the details below)"}),v.map(e=>s("option",{value:e.id,children:[e.username,"@",e.server.hostname,":",e.ssh_port," ",e.key_id===null?"Password":"Key"]}))]})]}),s("div",{className:"sm:col-span-2 col-span-4",children:[a(n,{forInput:"username",value:"Username"}),a(c,{id:"username",name:"username",value:t.username,className:"mt-1 block w-full",autoComplete:"username",handleChange:e=>r("username",e.target.value),maxLength:64,disabled:o}),a(m,{message:d.username,className:"mt-2"})]}),s("div",{className:"sm:col-span-2 col-span-4",children:[a(n,{forInput:"port",value:"Port"}),a(c,{type:"number",name:"port",className:"mt-1 block w-full",autoComplete:"port",value:t.port,handleChange:e=>r("port",e.target.value),disabled:o}),a(m,{message:d.port,className:"mt-2"})]}),a("p",{children:a("a",{className:"font-medium text-blue-600 dark:text-blue-500 hover:underline",href:route("key.index"),children:"Manage keys"})}),s("div",{className:"sm:col-span-4 col-span-4",children:[a("div",{className:"mb-2 block",children:a(n,{forInput:"key_id",value:"Key"})}),s(p,{onChange:e=>r("key_id",e.target.value),name:"key_id",value:t.key_id,handleChange:e=>r("key_id",e.target.value),disabled:o,children:[a("option",{value:"",children:"None. Use password"}),f.map(e=>a("option",{value:e.id,children:e.original_name},e.id))]})]}),a("div",{className:"mt-2 sm:col-span-4 col-span-4",children:a("p",{className:"text-gray-500 dark:text-gray-400",children:"Passwords are stored encrypted"})}),s("div",{className:"col-span-4",children:[a(n,{forInput:"password",value:"Password"}),a(c,{name:"password",className:"mt-1 block w-full",autoComplete:"password",value:t.password,handleChange:e=>r("password",e.target.value),disabled:o}),a(m,{message:d.password,className:"mt-2"})]})]}),a(T,{className:"inline-flex items-center px-5 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white bg-primary-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-primary-800",processing:x,children:"Create SFTP Connection"})]})})]})]})}export{Q as default};
